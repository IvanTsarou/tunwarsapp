<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Детали локации - TunWars: Episode I - Тунисская угроза</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .hero-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }
        
        .star-wars-badge {
            background: linear-gradient(135deg, #FFE81F 0%, #FFC107 100%);
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .photo-slider-container {
            position: relative;
            width: 100%;
            height: 60vh;
            min-height: 300px;
            max-height: 900px;
            overflow: hidden;
            background: #000;
            border-radius: 0.5rem;
        }
        
        @media (min-width: 640px) {
            .photo-slider-container {
                height: 70vh;
                min-height: 400px;
                border-radius: 0.75rem;
            }
        }
        
        @media (min-width: 768px) {
            .photo-slider-container {
                height: 85vh;
                min-height: 600px;
                border-radius: 1rem;
            }
        }
        
        .photo-slider {
            display: flex;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            height: 100%;
            will-change: transform;
            touch-action: pan-y pinch-zoom;
        }
        
        .photo-slide {
            flex-shrink: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #000;
        }
        
        .photo-slide img {
            max-width: 100%;
            max-height: 100%;
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }
        
        .slider-nav-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            z-index: 15;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        @media (min-width: 640px) {
            .slider-nav-btn {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
        
        @media (min-width: 768px) {
            .slider-nav-btn {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
        }
        
        .slider-nav-btn:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: translateY(-50%) scale(1.1);
        }
        
        .slider-nav-btn:active {
            transform: translateY(-50%) scale(0.95);
        }
        
        .slider-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        
        .slider-nav-prev {
            left: 8px;
        }
        
        .slider-nav-next {
            right: 8px;
        }
        
        @media (min-width: 640px) {
            .slider-nav-prev {
                left: 12px;
            }
            
            .slider-nav-next {
                right: 12px;
            }
        }
        
        @media (min-width: 768px) {
            .slider-nav-prev {
                left: 20px;
            }
            
            .slider-nav-next {
                right: 20px;
            }
        }
        
        .slider-indicators {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
            z-index: 10;
        }
        
        @media (min-width: 640px) {
            .slider-indicators {
                bottom: 15px;
                gap: 8px;
            }
        }
        
        @media (min-width: 768px) {
            .slider-indicators {
                bottom: 20px;
                gap: 10px;
            }
        }
        
        .slider-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        @media (min-width: 640px) {
            .slider-indicator {
                width: 10px;
                height: 10px;
            }
        }
        
        @media (min-width: 768px) {
            .slider-indicator {
                width: 12px;
                height: 12px;
            }
        }
        
        .slider-indicator.active {
            background: white;
            width: 24px;
            border-radius: 4px;
        }
        
        @media (min-width: 768px) {
            .slider-indicator.active {
                width: 30px;
                border-radius: 6px;
            }
        }
        
        .slider-counter {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 10;
            backdrop-filter: blur(10px);
        }
        
        .back-button {
            display: inline-flex !important;
            align-items: center !important;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%) !important;
            color: white !important;
            padding: 0.5rem 1rem !important;
            border-radius: 0.5rem !important;
            font-weight: 600 !important;
            font-size: 0.875rem !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1) !important;
            text-decoration: none !important;
            border: 2px solid rgba(255, 255, 255, 0.2) !important;
            flex-shrink: 0 !important;
            white-space: nowrap !important;
        }
        
        .back-button:hover {
            background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%) !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.15) !important;
        }
        
        .location-header {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 1rem !important;
            padding: 0.5rem 0 !important;
            flex-wrap: wrap !important;
        }
        
        .location-title-wrapper {
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            gap: 0.25rem !important;
            flex: 1 !important;
            min-width: 0 !important;
        }
        
        .location-title {
            font-size: 1.5rem !important;
            font-weight: 800 !important;
            color: #ffffff !important;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3) !important;
            margin: 0 !important;
            letter-spacing: -0.02em;
            line-height: 1.2 !important;
            text-align: center !important;
        }
        
        @media (min-width: 640px) {
            .location-title {
                font-size: 1.75rem !important;
            }
        }
        
        @media (min-width: 768px) {
            .location-title {
                font-size: 2rem !important;
            }
        }
        
        .location-region {
            font-size: 0.75rem !important;
            font-weight: 500 !important;
            color: rgba(255, 255, 255, 0.9) !important;
            background: rgba(255, 255, 255, 0.15) !important;
            backdrop-filter: blur(10px) !important;
            padding: 0.25rem 1rem !important;
            border-radius: 2rem !important;
            display: inline-block !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2) !important;
            line-height: 1.3 !important;
        }
        
        #lightbox-image {
            transition: opacity 0.3s ease;
        }
        
        #lightbox-prev, #lightbox-next {
            transition: all 0.3s ease;
        }
        
        #lightbox-prev:hover:not(:disabled), #lightbox-next:hover:not(:disabled) {
            transform: translateY(-50%) scale(1.2);
        }
        
        #lightbox-close:hover {
            transform: rotate(90deg);
        }
    </style>
</head>
<body class="bg-gray-50">
    
    <!-- Header -->
    <header class="hero-gradient text-white py-4 shadow-2xl">
        <div class="container mx-auto px-4">
            <!-- Location Header with Back Button on same line -->
            <div id="location-header" class="location-header">
                <a href="index.html" class="back-button">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Назад
                </a>
                <div class="location-title-wrapper">
                    <h1 class="location-title" id="location-title">Загрузка...</h1>
                    <p class="location-region" id="location-region"></p>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6 md:py-12">
        
        <!-- Star Wars Badge -->
        <div id="star-wars-badge-container" class="mb-6" style="display: none;">
            <span class="star-wars-badge inline-flex items-center px-6 py-3 rounded-full text-lg font-bold text-black shadow-lg">
                <i class="fas fa-jedi mr-2"></i>ЛОКАЦИЯ ИЗ ЗВЁЗДНЫХ ВОЙН
            </span>
        </div>
        
        <!-- Photo Gallery Slider -->
        <section class="mb-6 md:mb-12">
            <div class="bg-white rounded-xl md:rounded-2xl shadow-lg overflow-hidden">
                <div id="photo-slider-container" class="photo-slider-container">
                    <div id="photo-slider" class="photo-slider">
                        <!-- Photos will be loaded here -->
                    </div>
                    <button id="slider-prev" class="slider-nav-btn slider-nav-prev" aria-label="Предыдущее фото">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button id="slider-next" class="slider-nav-btn slider-nav-next" aria-label="Следующее фото">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <div id="slider-indicators" class="slider-indicators">
                        <!-- Indicators will be loaded here -->
                    </div>
                    <div id="slider-counter" class="slider-counter">
                        <!-- Counter will be updated here -->
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Description -->
        <section class="mb-6 md:mb-12">
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-info-circle mr-2 text-blue-600"></i>
                    Описание
                </h2>
                <div id="location-description" class="text-gray-700 leading-relaxed text-lg">
                    Загрузка...
                </div>
            </div>
        </section>
        
        <!-- Map and Coordinates -->
        <section class="mb-12">
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-map-marked-alt mr-2 text-green-600"></i>
                    Расположение
                </h2>
                <div id="location-map" style="height: 400px; border-radius: 1rem;" class="mb-4"></div>
                <div class="flex flex-wrap gap-4 items-center pt-4 border-t border-gray-100">
                    <div class="flex items-center text-gray-600">
                        <i class="fas fa-map-marker-alt mr-2 text-green-600"></i>
                        <span id="location-coordinates"></span>
                    </div>
                    <div class="flex gap-4">
                        <a id="google-maps-link" href="#" target="_blank" class="flex items-center text-blue-600 hover:text-blue-800 font-medium transition">
                            <i class="fab fa-google mr-2"></i>
                            Google Maps
                        </a>
                        <span class="text-gray-300">|</span>
                        <a id="mapsme-link" href="#" class="flex items-center text-green-600 hover:text-green-800 font-medium transition">
                            <i class="fas fa-map-marked-alt mr-2"></i>
                            Maps.me
                        </a>
                    </div>
                </div>
            </div>
        </section>
        
    </main>
    
    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-16">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-300">
                <i class="fas fa-map-marker-alt mr-2"></i>
                Справочник локаций Туниса - 2024
            </p>
        </div>
    </footer>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    
    <!-- Location Data -->
    <script src="./%D0%9B%D0%BE%D0%BA%D0%B0%D1%86%D0%B8%D0%B8%20%D0%A2%D1%83%D0%BD%D0%B8%D1%81%D0%B0%20-%20%D0%98%D0%BD%D1%82%D0%B5%D1%80%D0%B0%D0%BA%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%B9%20%D1%81%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D1%87%D0%BD%D0%B8%D0%BA_files/locations-data.js"></script>
    
    <!-- Detailed Descriptions -->
    <script src="./%D0%9B%D0%BE%D0%BA%D0%B0%D1%86%D0%B8%D0%B8%20%D0%A2%D1%83%D0%BD%D0%B8%D1%81%D0%B0%20-%20%D0%98%D0%BD%D1%82%D0%B5%D1%80%D0%B0%D0%BA%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%B9%20%D1%81%D0%BF%D1%80%D0%B0%D0%B2%D0%BE%D1%87%D0%BD%D0%B8%D0%BA_files/detailed-descriptions.js"></script>
    
    <!-- Page Script -->
    <script>
        // Получаем ID локации из URL
        const urlParams = new URLSearchParams(window.location.search);
        const locationId = parseInt(urlParams.get('id'));
        
        let map;
        let currentLocation;
        
        // Загрузка данных локации
        function loadLocation() {
            if (!locations || locations.length === 0) {
                document.getElementById('location-title').textContent = 'Ошибка загрузки';
                return;
            }
            
            currentLocation = locations.find(loc => loc.id === locationId);
            
            if (!currentLocation) {
                document.getElementById('location-title').textContent = 'Локация не найдена';
                return;
            }
            
            // Обновляем заголовок
            document.getElementById('location-title').textContent = currentLocation.name;
            document.getElementById('location-region').textContent = currentLocation.region;
            document.title = `${currentLocation.name} - TunWars: Episode I - Тунисская угроза`;
            
            // Показываем бейдж Звёздных войн
            if (currentLocation.isStarWars) {
                document.getElementById('star-wars-badge-container').style.display = 'block';
            }
            
            // Загружаем описание
            loadDescription();
            
            // Загружаем фото
            loadPhotos();
            
            // Загружаем карту
            loadMap();
            
            // Обновляем координаты и ссылки
            updateCoordinates();
            
            // Обработчики для слайдера (после загрузки фото)
            setTimeout(() => {
                const prevBtn = document.getElementById('slider-prev');
                const nextBtn = document.getElementById('slider-next');
                const slider = document.getElementById('photo-slider');
                
                if (prevBtn && !prevBtn.onclick) {
                    prevBtn.addEventListener('click', prevSlide);
                }
                if (nextBtn && !nextBtn.onclick) {
                    nextBtn.addEventListener('click', nextSlide);
                }
                
                // Добавляем поддержку свайпа для мобильных устройств
                if (slider) {
                    initSwipeSupport(slider);
                }
            }, 100);
        }
        
        // Загрузка описания
        function loadDescription() {
            const descContainer = document.getElementById('location-description');
            const detailedDescription = getDetailedDescription(currentLocation);
            descContainer.innerHTML = detailedDescription;
        }
        
        // Глобальные переменные для слайдера
        let currentSlideIndex = 0;
        let sliderPhotos = [];
        
        // Загрузка фото в слайдер
        function loadPhotos() {
            const slider = document.getElementById('photo-slider');
            const prevBtn = document.getElementById('slider-prev');
            const nextBtn = document.getElementById('slider-next');
            const indicators = document.getElementById('slider-indicators');
            const counter = document.getElementById('slider-counter');
            
            sliderPhotos = getLocationPhotos(currentLocation);
            currentSlideIndex = 0;
            
            if (!sliderPhotos || sliderPhotos.length === 0) {
                slider.innerHTML = `
                    <div class="photo-slide" style="display: flex; align-items: center; justify-content: center; color: white;">
                        <div class="text-center">
                            <i class="fas fa-image text-6xl text-gray-400 mb-4"></i>
                            <p class="text-gray-400 text-lg">Фотографии для этой локации отсутствуют</p>
                        </div>
                    </div>
                `;
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
                indicators.innerHTML = '';
                counter.textContent = '';
                return;
            }
            
            // Кодируем пути к фото для безопасного использования в HTML
            slider.innerHTML = sliderPhotos.map((photo, index) => {
                // Кодируем путь для фото
                let encodedPhoto = photo;
                if (!photo.startsWith('http')) {
                    const pathParts = photo.split('/');
                    encodedPhoto = pathParts.map((part, idx) => {
                        if (idx === 0) return part;
                        return encodeURIComponent(part);
                    }).join('/');
                }
                
                return `
                    <div class="photo-slide">
                        <img src="${encodedPhoto}" 
                             alt="${currentLocation.name} - фото ${index + 1}" 
                             onerror="this.parentElement.innerHTML='<div style=\\'display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; color: white;\\'><i class=\\'fas fa-image\\' style=\\'font-size: 48px;\\'></i></div>';"
                             loading="lazy">
                    </div>
                `;
            }).join('');
            
            // Обновляем индикаторы
            indicators.innerHTML = sliderPhotos.map((_, index) => `
                <button class="slider-indicator ${index === 0 ? 'active' : ''}" 
                        data-index="${index}"
                        onclick="goToSlide(${index})"
                        aria-label="Перейти к фото ${index + 1}"></button>
            `).join('');
            
            // Обновляем счетчик
            updateCounter();
            
            // Обновляем кнопки
            updateNavButtons();
            
            // Перемещаем слайдер в начало
            updateSliderPosition();
            
            // Показываем/скрываем кнопки в зависимости от количества фото
            if (sliderPhotos.length <= 1) {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
                indicators.innerHTML = '';
            } else {
                prevBtn.style.display = 'flex';
                nextBtn.style.display = 'flex';
            }
        }
        
        // Обновление позиции слайдера
        function updateSliderPosition() {
            const slider = document.getElementById('photo-slider');
            if (slider) {
                const slideWidth = slider.offsetWidth;
                const translateX = -(currentSlideIndex * slideWidth);
                slider.style.transform = `translateX(${translateX}px)`;
                slider.style.transition = 'transform 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
            }
        }
        
        // Обновление счетчика
        function updateCounter() {
            const counter = document.getElementById('slider-counter');
            if (counter && sliderPhotos.length > 0) {
                counter.textContent = `${currentSlideIndex + 1} / ${sliderPhotos.length}`;
            }
        }
        
        // Обновление кнопок навигации
        function updateNavButtons() {
            const prevBtn = document.getElementById('slider-prev');
            const nextBtn = document.getElementById('slider-next');
            
            if (prevBtn) {
                prevBtn.disabled = currentSlideIndex === 0;
            }
            if (nextBtn) {
                nextBtn.disabled = currentSlideIndex === sliderPhotos.length - 1;
            }
        }
        
        // Обновление индикаторов
        function updateIndicators() {
            const indicators = document.querySelectorAll('.slider-indicator');
            indicators.forEach((indicator, index) => {
                if (index === currentSlideIndex) {
                    indicator.classList.add('active');
                } else {
                    indicator.classList.remove('active');
                }
            });
        }
        
        // Переход к слайду
        function goToSlide(index) {
            if (index < 0 || index >= sliderPhotos.length) return;
            currentSlideIndex = index;
            updateSliderPosition();
            updateCounter();
            updateNavButtons();
            updateIndicators();
        }
        
        // Переход к следующему слайду
        function nextSlide() {
            if (currentSlideIndex < sliderPhotos.length - 1) {
                goToSlide(currentSlideIndex + 1);
            }
        }
        
        // Переход к предыдущему слайду
        function prevSlide() {
            if (currentSlideIndex > 0) {
                goToSlide(currentSlideIndex - 1);
            }
        }
        
        // Навигация клавиатурой для слайдера
        document.addEventListener('keydown', function(e) {
            const slider = document.getElementById('photo-slider');
            if (!slider || !sliderPhotos || sliderPhotos.length === 0) return;
            
            // Не перехватываем, если focus на input/textarea
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            
            if (e.key === 'ArrowLeft') {
                e.preventDefault();
                prevSlide();
            } else if (e.key === 'ArrowRight') {
                e.preventDefault();
                nextSlide();
            }
        });
        
        // Загрузка карты
        function loadMap() {
            const [lon, lat] = currentLocation.coordinates;
            
            map = L.map('location-map').setView([lat, lon], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                maxZoom: 19
            }).addTo(map);
            
            // Добавляем маркер
            const icon = createMarkerIcon(currentLocation);
            const marker = L.marker([lat, lon], { icon }).addTo(map);
            
            marker.bindPopup(`
                <div style="padding: 10px; min-width: 200px;">
                    <h3 style="margin: 0 0 10px 0; font-size: 1.2em; font-weight: bold;">${currentLocation.name}</h3>
                    <p style="margin: 5px 0; color: #666; font-size: 0.9em;"><strong>Регион:</strong> ${currentLocation.region}</p>
                    ${currentLocation.isStarWars ? '<p style="margin: 5px 0;"><span style="background: linear-gradient(135deg, #FFE81F 0%, #FFC107 100%); color: #000; padding: 3px 8px; border-radius: 12px; font-size: 0.8em; font-weight: bold;">⭐ ЗВЁЗДНЫЕ ВОЙНЫ</span></p>' : ''}
                </div>
            `).openPopup();
        }
        
        // Создание иконки маркера
        function createMarkerIcon(location) {
            const color = location.isStarWars ? '#FFE81F' : '#3B82F6';
            const iconClass = location.isStarWars ? 'fa-jedi' : 'fa-map-marker-alt';
            
            return L.divIcon({
                className: 'custom-marker',
                html: `
                    <div style="
                        background: ${location.isStarWars ? 'linear-gradient(135deg, #FFE81F 0%, #FFC107 100%)' : color};
                        width: 40px;
                        height: 40px;
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border: ${location.isStarWars ? '3px solid #000' : '2px solid white'};
                        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
                    ">
                        <i class="fas ${iconClass}" style="color: ${location.isStarWars ? '#000' : 'white'}; font-size: 18px;"></i>
                    </div>
                `,
                iconSize: [40, 40],
                iconAnchor: [20, 20]
            });
        }
        
        // Обновление координат и ссылок
        function updateCoordinates() {
            const [lon, lat] = currentLocation.coordinates;
            
            document.getElementById('location-coordinates').textContent = `${lat.toFixed(4)}, ${lon.toFixed(4)}`;
            
            const googleMapsUrl = `https://www.google.com/maps?q=${lat},${lon}`;
            const mapsMeUrl = `mapsme://map?v=1&ll=${lat},${lon}&n=${encodeURIComponent(currentLocation.name)}`;
            
            document.getElementById('google-maps-link').href = googleMapsUrl;
            document.getElementById('mapsme-link').href = mapsMeUrl;
        }
        
        // Получить фото локации
        function getLocationPhotos(location) {
            if (location.photos && location.photos.length > 0) {
                return location.photos.slice(0, 10); // До 10 фото
            }
            // Если нет фото, возвращаем пустой массив
            return [];
        }
        
        // Получить подробное описание
        function getDetailedDescription(location) {
            if (typeof detailedDescriptions !== 'undefined') {
                const desc = detailedDescriptions[String(location.id)];
                if (desc) {
                    return desc;
                }
            }
            // Расширяем базовое описание
            let description = `<p class="mb-4">${location.description}</p>`;
            if (location.isStarWars) {
                description += `<p class="mb-4"><strong>⭐ Связь со Звёздными войнами:</strong></p>
                <p class="mb-4">Эта локация использовалась при съемках знаменитой саги "Звёздные войны". Здесь снимались сцены на планете Татуин и другие культовые моменты фильма.</p>`;
            }
            return description || 'Описание отсутствует';
        }
        
        // Глобальные переменные для lightbox
        let currentPhotoIndex = 0;
        let lightboxModal = null;
        let lightboxPhotos = [];
        let keyboardHandler = null;
        
        // Lightbox для фото
        function openLightbox(photoUrl, index) {
            lightboxPhotos = getLocationPhotos(currentLocation);
            if (!lightboxPhotos || lightboxPhotos.length === 0) {
                lightboxPhotos = [photoUrl];
            }
            currentPhotoIndex = index;
            
            // Создаем модальное окно
            lightboxModal = document.createElement('div');
            lightboxModal.className = 'fixed inset-0 bg-black bg-opacity-95 z-50 flex items-center justify-center';
            lightboxModal.id = 'lightbox-modal';
            lightboxModal.innerHTML = `
                <div class="relative max-w-7xl w-full mx-4">
                    <button id="lightbox-close" class="absolute top-4 right-4 text-white text-4xl hover:text-gray-300 z-10 transition">
                        <i class="fas fa-times"></i>
                    </button>
                    <img id="lightbox-image" src="${photoUrl}" alt="${currentLocation.name}" class="max-w-full max-h-screen mx-auto rounded-lg shadow-2xl">
                    <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-4 py-2 rounded-full">
                        Фото ${index + 1} из ${lightboxPhotos.length}
                    </div>
                    ${lightboxPhotos.length > 1 ? `
                        <button id="lightbox-prev" class="absolute left-4 top-1/2 transform -translate-y-1/2 text-white text-5xl hover:text-gray-300 transition ${index === 0 ? 'opacity-30 cursor-not-allowed' : ''}" ${index === 0 ? 'disabled' : ''}>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button id="lightbox-next" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-white text-5xl hover:text-gray-300 transition ${index === lightboxPhotos.length - 1 ? 'opacity-30 cursor-not-allowed' : ''}" ${index === lightboxPhotos.length - 1 ? 'disabled' : ''}>
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    ` : ''}
                </div>
            `;
            
            document.body.appendChild(lightboxModal);
            document.body.style.overflow = 'hidden'; // Блокируем скролл страницы
            
            // Обработчики событий
            setupLightboxHandlers();
        }
        
        // Настройка обработчиков для lightbox
        function setupLightboxHandlers() {
            if (!lightboxModal) return;
            
            // Закрытие
            const closeBtn = lightboxModal.querySelector('#lightbox-close');
            if (closeBtn) {
                closeBtn.onclick = closeLightbox;
            }
            
            // Навигация
            const prevBtn = lightboxModal.querySelector('#lightbox-prev');
            const nextBtn = lightboxModal.querySelector('#lightbox-next');
            
            if (prevBtn) {
                prevBtn.onclick = () => navigatePhoto(-1);
            }
            if (nextBtn) {
                nextBtn.onclick = () => navigatePhoto(1);
            }
            
            // Закрытие по клику на фон
            lightboxModal.addEventListener('click', (e) => {
                if (e.target === lightboxModal) {
                    closeLightbox();
                }
            });
            
            // Навигация стрелками клавиатуры
            keyboardHandler = function(e) {
                if (e.key === 'Escape') {
                    closeLightbox();
                } else if (e.key === 'ArrowLeft') {
                    navigatePhoto(-1);
                } else if (e.key === 'ArrowRight') {
                    navigatePhoto(1);
                }
            };
            document.addEventListener('keydown', keyboardHandler);
        }
        
        // Навигация по фото
        function navigatePhoto(direction) {
            const newIndex = currentPhotoIndex + direction;
            if (newIndex < 0 || newIndex >= lightboxPhotos.length) return;
            
            currentPhotoIndex = newIndex;
            updateLightboxImage();
        }
        
        // Обновление изображения в lightbox
        function updateLightboxImage() {
            if (!lightboxModal) return;
            
            const img = lightboxModal.querySelector('#lightbox-image');
            const counter = lightboxModal.querySelector('.absolute.bottom-4');
            const prevBtn = lightboxModal.querySelector('#lightbox-prev');
            const nextBtn = lightboxModal.querySelector('#lightbox-next');
            
            if (img) {
                img.style.opacity = '0';
                setTimeout(() => {
                    img.src = lightboxPhotos[currentPhotoIndex];
                    img.alt = `${currentLocation.name} - фото ${currentPhotoIndex + 1}`;
                    img.style.opacity = '1';
                }, 150);
            }
            
            if (counter) {
                counter.textContent = `Фото ${currentPhotoIndex + 1} из ${lightboxPhotos.length}`;
            }
            
            // Обновляем кнопки навигации
            if (prevBtn) {
                if (currentPhotoIndex === 0) {
                    prevBtn.classList.add('opacity-30', 'cursor-not-allowed');
                    prevBtn.disabled = true;
                } else {
                    prevBtn.classList.remove('opacity-30', 'cursor-not-allowed');
                    prevBtn.disabled = false;
                }
            }
            
            if (nextBtn) {
                if (currentPhotoIndex === lightboxPhotos.length - 1) {
                    nextBtn.classList.add('opacity-30', 'cursor-not-allowed');
                    nextBtn.disabled = true;
                } else {
                    nextBtn.classList.remove('opacity-30', 'cursor-not-allowed');
                    nextBtn.disabled = false;
                }
            }
        }
        
        // Закрытие lightbox
        function closeLightbox() {
            if (lightboxModal) {
                lightboxModal.remove();
                lightboxModal = null;
            }
            if (keyboardHandler) {
                document.removeEventListener('keydown', keyboardHandler);
                keyboardHandler = null;
            }
            document.body.style.overflow = ''; // Восстанавливаем скролл
        }
        
        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof locations !== 'undefined') {
                loadLocation();
            } else {
                window.addEventListener('load', function() {
                    setTimeout(loadLocation, 500);
                });
            }
        });
    </script>
    
</body>
</html>

